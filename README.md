# –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (Notify Service)

![Python](https://img.shields.io/badge/Python-3.12-blue?logo=python)
![Django](https://img.shields.io/badge/Django-5.2-green?logo=django)
![Django REST Framework](https://img.shields.io/badge/DRF-3.16-red?logo=django)
![Celery](https://img.shields.io/badge/Celery-5.5-green?logo=celery)
![PostgreSQL](https://img.shields.io/badge/PostgreSQL-17-orange?logo=postgresql)
![Redis](https://img.shields.io/badge/Redis-7.0-red?logo=redis)
![Docker](https://img.shields.io/badge/Docker-24.0-blue?logo=docker)
![Nginx](https://img.shields.io/badge/Nginx-1.25-green?logo=nginx)

## üìö –û–ø–∏—Å–∞–Ω–∏–µ

–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø–æ email –∏ Telegram. –°–µ—Ä–≤–∏—Å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç REST API –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ –∏ –¥–µ—Ç–∞–ª—å–Ω—ã–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º –¥–æ—Å—Ç–∞–≤–∫–∏.

## üß© –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

- **üìß Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** - –æ—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ SMTP —Å–µ—Ä–≤–µ—Ä
- **üì± Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** - –æ—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ Telegram Bot API
- **‚è∞ –û—Ç–ª–æ–∂–µ–Ω–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∑–∞–¥–µ—Ä–∂–µ–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ (–Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ, —á–µ—Ä–µ–∑ 1 —á–∞—Å, —á–µ—Ä–µ–∑ 1 –¥–µ–Ω—å)
- **üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–æ—Å—Ç–∞–≤–∫–∏** - –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ –æ—Ç–ø—Ä–∞–≤–∫–∏
- **üöÄ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Celery –¥–ª—è —Ñ–æ–Ω–æ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–¥–∞—á
- **üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏
- **üìà Health checks** - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

- **Django 5.2** - –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- **Django REST Framework** - REST API
- **Celery** - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–¥–∞—á
- **PostgreSQL** - –æ—Å–Ω–æ–≤–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö
- **Redis** - –±—Ä–æ–∫–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è Celery –∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- **Docker & Docker Compose** - –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è
- **Nginx** - reverse proxy –∏ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
- **Gunicorn** - WSGI —Å–µ—Ä–≤–µ—Ä
- **Telegram Bot API** - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ Telegram

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
- **Notification** - –æ—Å–Ω–æ–≤–Ω–∞—è –º–æ–¥–µ–ª—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- **Recipient** - –ø–æ–ª—É—á–∞—Ç–µ–ª–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- **DeliveryLog** - –ª–æ–≥–∏ –¥–æ—Å—Ç–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π

### –°–µ—Ä–≤–∏—Å—ã
- **NotificationService** - —Ñ–∞—Å–∞–¥ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- **EmailSender** - —Å–µ—Ä–≤–∏—Å –æ—Ç–ø—Ä–∞–≤–∫–∏ email
- **TelegramSender** - —Å–µ—Ä–≤–∏—Å –æ—Ç–ø—Ä–∞–≤–∫–∏ Telegram —Å–æ–æ–±—â–µ–Ω–∏–π

### Celery –∑–∞–¥–∞—á–∏
- `send_notification_task` - –æ—Å–Ω–æ–≤–Ω–∞—è –∑–∞–¥–∞—á–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏
- `send_email_task` - –∑–∞–¥–∞—á–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ email
- `send_telegram_task` - –∑–∞–¥–∞—á–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ Telegram

## üìã API Endpoints

### –°–æ–∑–¥–∞–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
```http
POST /api/notify/
```

### –¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:

```json
{
  "message": "–¢–µ–∫—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è",
  "recipient": ["user@example.com", "123456789"],
  "delay": 0
}
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**

- `message` (string, 1-1024 —Å–∏–º–≤–æ–ª–æ–≤) - —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
- `recipient` (array) - —Å–ø–∏—Å–æ–∫ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π (email –∏–ª–∏ —á–∏—Å–ª–æ–≤–æ–π Telegram ID)
- `delay` (integer) - –∑–∞–¥–µ—Ä–∂–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:
  - `0` - –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ
  - `1` - —á–µ—Ä–µ–∑ 1 —á–∞—Å
  - `2` - —á–µ—Ä–µ–∑ 1 –¥–µ–Ω—å

### Health check
```http
GET /health/
```

## üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Docker –∏ Docker Compose
- Python 3.12 (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
git clone <repository-url>
cd notify-service
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –Ω–∞ –æ—Å–Ω–æ–≤–µ `.env.example`:

```bash
cp .env.example .env
```

–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

```env
# Django
SECRET_KEY=your-secret-key
DEBUG=False
ALLOWED_HOSTS=localhost,127.0.0.1

# Database
POSTGRES_DB=notify
POSTGRES_USER=postgres
POSTGRES_PASSWORD=password
POSTGRES_HOST=notify_service.db
POSTGRES_PORT=5432

# Email
EMAIL_HOST=smtp.yandex.ru
EMAIL_PORT=465
EMAIL_USE_SSL=True
EMAIL_HOST_USER=your-email@yandex.ru
EMAIL_HOST_PASSWORD=your-password

# Telegram
TELEGRAM_BOT_TOKEN=your-telegram-bot-token
```

### 3. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose --profile app --profile first up --build

# –ò–ª–∏ –≤—ã–±–æ—Ä–æ—á–Ω—ã–π –∑–∞–ø—É—Å–∫
docker-compose --profile app up --build      # Django + Nginx
docker-compose --profile worker up --build   # Celery worker + beat
docker-compose --profile migration up --build # –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
docker-compose --profile monitoring up # Flower
```

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ü—Ä–∏–º–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

```bash
curl -X POST http://localhost:8000/api/notify/ \
  -H "Content-Type: application/json" \
  -d '{
    "message": "–í–∞—à–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ",
    "recipient": ["user@example.com", "123456789"],
    "delay": 0
  }'
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–∏—Å–∞

```bash
curl http://localhost:8000/health/
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π (email –∏ —á–∏—Å–ª–æ–≤—ã–µ Telegram ID)

- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏

- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª–∏–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏–π

- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ SSL/TLS –¥–ª—è email

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ—Ä–µ–∑ Celery

- Connection pooling –¥–ª—è –ë–î

- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ Redis

- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è

## ü§ù –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

```bash
cd notify_api
poetry install
poetry shell
```

### –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π

``bash
python manage.py makemigrations
```

### –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

```bash
python manage.py runserver
```

### üë• –ê–≤—Ç–æ—Ä—ã

- –ï–≤–≥–µ–Ω–∏–π –ö—É–¥—Ä—è—à–æ–≤ - [GitHub](https://github.com/GagarinRu/)
